const app = new Vue({
    el : '#app'
    , store : store
    , template : `
        <div class="evtContV15">        
            <div class="mEvt115629">
				<h2><img src="//webimage.10x10.co.kr/fixevent/event/2021/115629/m/top.jpg" alt="happy 2022 wake up"></h2>
				<div class="section prd01">
                    <img src="//webimage.10x10.co.kr/fixevent/event/2021/115629/m/prd01.jpg?v=4" alt="깔끔하게 정리하는 미너멀라이프">
                    <a href="/category/category_itemPrd.asp?itemid=3073479&pEtr=115629" onclick="TnGotoProduct('3073479');return false;" class="item01 item3073479">
                        <div class="desc">
                            <span class="wish"><span class="icon"></span><span class="counting">0</span></span>
                        </div>
                    </a>
                    <a href="/category/category_itemPrd.asp?itemid=3825689&pEtr=115629" onclick="TnGotoProduct('3825689');return false;" class="item02 item3825689">
                        <div class="desc">
                            <span class="wish"><span class="icon"></span><span class="counting">0</span></span>
                        </div>
                    </a>
                    <a href="/category/category_itemPrd.asp?itemid=1736999&pEtr=115629" onclick="TnGotoProduct('1736999');return false;" class="item03 item1736999">
                        <div class="desc">
                            <span class="wish"><span class="icon"></span><span class="counting">0</span></span>
                        </div>
                    </a>
                </div>
                <div class="section prd02">
                    <img src="//webimage.10x10.co.kr/fixevent/event/2021/115629/m/prd02.jpg?v=3" alt="작심삼일 그만! 올해는 꼭 다이어트 성공!">
                    <a href="/category/category_itemPrd.asp?itemid=3086753&pEtr=115629" onclick="TnGotoProduct('3086753');return false;" class="item01 item3086753">
                        <div class="desc">
                            <span class="wish"><span class="icon"></span><span class="counting">0</span></span>
                        </div>
                    </a>
                    <a href="/category/category_itemPrd.asp?itemid=4096410&pEtr=115629" onclick="TnGotoProduct('4096410');return false;" class="item02 item4096410">
                        <div class="desc">
                            <span class="wish"><span class="icon"></span><span class="counting">0</span></span>
                        </div>
                    </a>
                    <a href="/category/category_itemPrd.asp?itemid=1791832&pEtr=115629" onclick="TnGotoProduct('1791832');return false;" class="item03 item1791832">
                        <div class="desc">
                            <span class="wish"><span class="icon"></span><span class="counting">0</span></span>
                        </div>
                    </a>
                    <a href="/category/category_itemPrd.asp?itemid=2917687&pEtr=115629" onclick="TnGotoProduct('2917687');return false;" class="item04 item2917687">
                        <div class="desc">
                            <span class="wish"><span class="icon"></span><span class="counting">0</span></span>
                        </div>
                    </a>
                    <a href="/category/category_itemPrd.asp?itemid=2512939&pEtr=115629" onclick="TnGotoProduct('2512939');return false;" class="item05 item2512939">
                        <div class="desc">
                            <span class="wish"><span class="icon"></span><span class="counting">0</span></span>
                        </div>
                    </a>
                </div>
                <div class="section prd03">
                    <img src="//webimage.10x10.co.kr/fixevent/event/2021/115629/m/prd03.jpg?v=3" alt="소중한 일상 기록하기!">
                    <a href="/category/category_itemPrd.asp?itemid=2864759&pEtr=115629" onclick="TnGotoProduct('2864759');return false;" class="item01 item2864759">
                        <div class="desc">
                            <span class="wish"><span class="icon"></span><span class="counting">0</span></span>
                        </div>
                    </a>
                    <a href="/category/category_itemPrd.asp?itemid=4029268&pEtr=115629" onclick="TnGotoProduct('4029268');return false;" class="item02 item4029268">
                        <div class="desc">
                            <span class="wish"><span class="icon"></span><span class="counting">0</span></span>
                        </div>
                    </a>
                    <a href="/category/category_itemPrd.asp?itemid=4200402&pEtr=115629" onclick="TnGotoProduct('4200402');return false;" class="item03 item4200402">
                        <div class="desc">
                            <span class="wish"><span class="icon"></span><span class="counting">0</span></span>
                        </div>
                    </a>
                </div>
                <div class="section prd04">
                    <img src="//webimage.10x10.co.kr/fixevent/event/2021/115629/m/prd04.jpg?v=3" alt="나홀로 취미 하나쯤 만들기!">
                    <a href="/category/category_itemPrd.asp?itemid=3020550&pEtr=115629" onclick="TnGotoProduct('3020550');return false;" class="item01 item3020550">
                        <div class="desc">
                            <span class="wish"><span class="icon"></span><span class="counting">0</span></span>
                        </div>
                    </a>
                    <a href="/category/category_itemPrd.asp?itemid=3887618&pEtr=115629" onclick="TnGotoProduct('3887618');return false;" class="item02 item3887618">
                        <div class="desc">
                            <span class="wish"><span class="icon"></span><span class="counting">0</span></span>
                        </div>
                    </a>
                    <a href="/category/category_itemPrd.asp?itemid=2140267&pEtr=115629" onclick="TnGotoProduct('2140267');return false;" class="item03 item2140267">
                        <div class="desc">
                            <span class="wish"><span class="icon"></span><span class="counting">0</span></span>
                        </div>
                    </a>
                </div>
                <div class="section prd05">
                    <img src="//webimage.10x10.co.kr/fixevent/event/2021/115629/m/prd05.jpg" alt="md meme style">
                    <a href="/category/category_itemPrd.asp?itemid=4242172&pEtr=115629" onclick="TnGotoProduct('4242172');return false;" class="item01">캐시미어 머플러</a>
                    <a href="/category/category_itemPrd.asp?itemid=4304474&pEtr=115629" onclick="TnGotoProduct('4304474');return false;" class="item02">kapka</a>
                    <a href="/category/category_itemPrd.asp?itemid=3398483&pEtr=115629" onclick="TnGotoProduct('3398483');return false;" class="item03">판도라</a>
                    <a href="/category/category_itemPrd.asp?itemid=4316834&pEtr=115629" onclick="TnGotoProduct('4316834');return false;" class="item04">케어베어 콜라보레이션 시계줄</a>
                    <a href="/category/category_itemPrd.asp?itemid=3504305&pEtr=115629" onclick="TnGotoProduct('3504305');return false;" class="item05">와플,샌드위치메이커</a>
                    <a href="/category/category_itemPrd.asp?itemid=2453471&pEtr=115629" onclick="TnGotoProduct('2453471');return false;" class="item06">로지텍</a>
                    <a href="/category/category_itemPrd.asp?itemid=4318375&pEtr=115629" onclick="TnGotoProduct('4318375');return false;" class="item07">아르르 겨울숲 에디션</a>
                    <a href="/category/category_itemPrd.asp?itemid=4337174&pEtr=115629" onclick="TnGotoProduct('4337174');return false;" class="item08">에뛰드</a>
                    <a href="/category/category_itemPrd.asp?itemid=4051527&pEtr=115629" onclick="TnGotoProduct('4051527');return false;" class="item09">쿠로미 가습기</a>
                    <a href="/category/category_itemPrd.asp?itemid=3947421&pEtr=115629" onclick="TnGotoProduct('3947421');return false;" class="item10">스누피 하우스 러그</a>
                    <a href="/category/category_itemPrd.asp?itemid=3947424&pEtr=115629" onclick="TnGotoProduct('3947424');return false;" class="item11">스누피러그</a>
                </div>
                <div class="comment-area">
                    <img src="//webimage.10x10.co.kr/fixevent/event/2021/115629/m/top_comment.jpg" alt="comment event">
                    <div class="comment-input">
                        <img src="//webimage.10x10.co.kr/fixevent/event/2021/115629/m/text_comment.jpg" alt="comment">
                        <div class="co-input">
                            <div class="placeholder">이 곳에 소원을 남기면 모두 이루어질거에요!<br/>수리수리 마수리!</div>
                            <textarea v-model="comment_text" @input="change_comment_text" id="input-letter" class="textarea" rows="1"></textarea>
                        </div>
                        <button @click="go_comment_reg" type="button">입력하기</button>
                    </div>
                    <!-- comment list -->
                    <div class="comment-list-wrap">
                        <div v-for="item in comment_list" class="comment-list">
                            <div class="top">
                                <div class="num">No.{{item.rownum}}</div>
                                <div class="id">{{item.userid}}</div>
                            </div>
                            <div class="txt" v-html="change_nr(item.evtcom_txt)">{{item.evtcom_txt}}</div>
                        </div>
                    </div>
                    <!-- page list -->
                    <div class="page-list">
                        <ul>
                            <li class="prev"><a @click="go_page(current_page_list_start-1)" href="javascript:void(0)">prev</a></li>
                            <template v-for="item in 6">
                                <li v-if="(item-1) + current_page_list_start <= totalpage" :class="[current_page == (item-1) + current_page_list_start ? 'current' : '']">
                                    <a @click="go_page((item-1) + current_page_list_start)" href="javascript:void(0)">{{(item-1) + current_page_list_start}}</a>
                                </li>
                            </template>
                            <li class="next"><a @click="go_page(current_page_list_start+6)" href="javascript:void(0)">next</a></li>
                        </ul>
                    </div>
                </div>
			</div>
        </div>
    `,
    created(){
        this.$store.commit("SET_EVT_CODE", 115629);
        this.$store.dispatch("GET_COMMENT_LIST");
    }
    , mounted(){
        $("#input-letter").on("propertychange change keyup paste input",function(){
            $(this)[0].style.height='auto';
            $(this).height( $(this).prop('scrollHeight'));
        });
        /* placeholder */
        var textarea = document.querySelector('.textarea');
        var placeholder = document.querySelector('.placeholder');

        textarea.addEventListener('focus', () => {
            placeholder.classList.add('placehidden');
        });

        textarea.addEventListener('blur', () => {
            if (textarea.value === '') {
                placeholder.classList.remove('placehidden');
            }
        });
        /* wish */
        fnApplyItemInfoEach({
            items:"3073479,3825689,1736999,3086753,4096410,1791832,2917687,2512939,2864759,4029268,4200402,3020550,3887618,2140267",
            target:"item",
            fields:["wish"]
        });
    }
    , computed : {
        evt_code(){
            return this.$store.getters.evt_code;
        }
        , comment_list(){
            return this.$store.getters.comment_list;
        }
        , totalpage(){
            return this.$store.getters.totalpage;
        }
        , current_page(){
            return this.$store.getters.current_page;
        }
        , current_page_list_start(){
            return this.$store.getters.current_page_list_start;
        }
    }
    , data() {
        return {
            comment_text : ""
            , ing_reg : false
        }
    }
    , methods : {
        go_comment_reg(){
            const _this = this;

            if(isUserLoginOK) {
                call_api("GET", "/tempEvent/user-comment-count", {"event_code" : _this.evt_code}, function (data) {
                    if(data >= 3){
                        alert("최대 3회까지까지 참여가 가능합니다.");
                        return false;
                    }else{
                        if(_this.comment_text.trim().length == 0){
                            alert("내용을 입력해주세요.");
                            return false
                        }
                        if (_this.ing_reg) {
                            return false;
                        }

                        _this.ing_reg = true;
                        let api_data = {
                            "event_code": _this.evt_code
                            , "evtcom_txt": _this.comment_text
                        };
                        call_api("POST", "/tempEvent/comment", api_data, function (data) {
                            alert("응모가 완료되었습니다.");

                            _this.comment_text = "";

                            _this.$store.dispatch("GET_COMMENT_LIST");
                            _this.ing_reg = false;
                        });
                    }
                });
            }else{
                alert("이벤트에 응모를 하려면 로그인이 필요합니다.");
            }
        }
        , go_page(page){
            if(page <= this.totalpage && page > 0){
                this.$store.commit("SET_CURRENT_PAGE", page);
                this.$store.dispatch("GET_COMMENT_LIST");
            }
        }
        , change_nr(text){
            return text.replaceAll("\n", "<br />");
        }
        , change_comment_text(e){
            if(e.target.value.length > 18){
                this.comment_text = this.comment_text.substr(0,18);
                alert("최대 18자까지 입력가능합니다.");
            }
        }
    }
});